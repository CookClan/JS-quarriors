import { Component, OnInit, Renderer2, ElementRef, Input } from '@angular/core';
import { DieSide } from '../shared/models/die-side';
import { Icon } from '../shared/models/icon.enum';
import { DomSanitizer } from '@angular/platform-browser';
const baseDraw = `<path d="M70.0344238,60.3176727c0,5.5483322-2.3381805,10.9421844-6.584095,15.1880188
c-5.3926468,5.3923264-13.3666,8.4855728-21.877224,8.4855728c-6.8757172,0-16.7080269-2.8987808-25.0860882-10.1110001
c-1.0973501-0.9447937-2.5315247-1.5250626-4.0926399-1.5250626c-3.4617872,0-6.2676687,2.8070831-6.2676687,6.2681427
c0,1.7100601,0.6978173,3.2767181,1.8084955,4.4073868c0.9056129,0.9221573,1.9488459,1.7336655,2.9795532,2.5279922
c11.6431332,8.9669266,24.7944679,9.6640167,28.547554,9.6640167c12.7973289,0,23.5520325-3.9910736,31.1022034-11.5411682
c7.9519501-7.951622,10.7852936-18.0814133,10.7852936-24.909359c0-7.9248924-2.8553391-15.3244362-7.8331985-20.3018951
c-3.825592-3.8256683-8.6603699-5.9325294-13.6139793-5.9325294c-5.2236328,0-10.0529518,1.9523773-13.5982399,5.4981499
c-0.9938545,0.993454-1.8492851,2.0777969-2.5605125,3.2273331c1.8606873-1.1887207,4.150692-1.8081741,6.7366562-1.8081741
C61.2626953,39.4550972,70.0344238,48.814167,70.0344238,60.3176727z"/>
<path d="M59.9026299,30.3666153c5.5487328,0,10.942585,2.3389854,15.1888237,6.5848999
c5.3923264,5.3922462,8.4851685,13.365715,8.4851685,21.8764191c0,6.8765259-2.8984528,16.7083511-10.1110001,25.0864868
c-0.9447937,1.0977554-1.5242615,2.531044-1.5242615,4.0930481c0,3.4609833,2.8058853,6.2672653,6.2673492,6.2672653
c1.7100525,0,3.2763138-0.6978149,4.4073868-1.8088989c0.9221497-0.9056091,1.7336578-1.9485245,2.5275879-2.9795532
c8.9673233-11.6431274,9.6644135-24.7940674,9.6644135-28.547554c0-12.796524-3.9906693-23.5520287-11.5407562-31.1022015
c-7.952034-7.9523525-18.0814209-10.7852936-24.9093666-10.7852936c-7.9244919,0-15.32444,2.8549404-20.3027,7.8332005
c-3.8252678,3.8263931-5.9321289,8.6603699-5.9321289,13.6142998c0,5.2237129,1.9527817,10.0529518,5.4981537,13.5979195
c0.9937706,0.9942551,2.0774727,1.8496819,3.2273331,2.5608292c-1.1887245-1.8606033-1.8085747-4.1502075-1.8085747-6.7369728
C39.0400581,39.1383476,48.3991241,30.3666153,59.9026299,30.3666153z"/>
<path d="M29.951973,40.4987335c0-5.549057,2.3385849-10.9429073,6.5844994-15.1888237
c5.3926468-5.3922462,13.3661995-8.4846897,21.877224-8.4846897c6.8757172,0,16.7079468,2.8979759,25.0860901,10.110199
c1.0969467,0.9447956,2.5314407,1.5250645,4.0926361,1.5250645c3.4613876,0,6.2676697-2.807085,6.2676697-6.2673454
c0-1.710947-0.6978149-3.2775173-1.8084946-4.407465c-0.9056091-0.9220734-1.9489212-1.7343864-2.9796295-2.5279121
C77.4289093,6.2900362,64.2775726,5.5937448,60.5244904,5.5937448c-12.7973289,0-23.552433,3.9902682-31.1022034,11.5403595
c-7.951952,7.9515495-10.7852936,18.081419-10.7852936,24.9093647c0,7.9248962,2.8549404,15.32444,7.8327999,20.3018951
c3.8255882,3.8256721,8.660368,5.9325294,13.6142979,5.9325294c5.2237129,0,10.0529518-1.9524612,13.5987244-5.4981499
c0.9934502-0.9934502,1.8488808-2.0770721,2.5600281-3.226532c-1.8606071,1.1886444-4.1510124,1.808094-6.7365723,1.808094
C38.7241058,61.3613052,29.951973,52.0023193,29.951973,40.4987335z"/>
<path d="M40.0840912,70.4490662c-5.5486526,0-10.9425049-2.3381805-15.1888237-6.5840988
c-5.3922443-5.3922424-8.4850903-13.3657951-8.4850903-21.8764191c0-6.8773232,2.8983784-16.7084274,10.1109219-25.0864887
c0.9444733-1.0977507,1.5243416-2.5319252,1.5243416-4.0930414c0-3.4617863-2.806282-6.2680697-6.2673473-6.2680697
c-1.7104588,0-3.2767124,0.6978173-4.407383,1.8088965c-0.9221535,0.9056129-1.7336645,1.9485245-2.5279922,2.9795532
c-8.9669228,11.6431322-9.6640167,24.7948685-9.6640167,28.547554c0,12.7973289,3.9906697,23.5520325,11.5403595,31.1021194
C24.6714134,78.931427,34.8008842,81.7644501,41.62883,81.7644501c7.9244919,0,15.3244362-2.8549423,20.3026962-7.8331985
c3.8252716-3.825592,5.9321289-8.6603699,5.9321289-13.6135788c0-5.2244377-1.9527817-10.0529518-5.4981499-13.5986443
c-0.9938545-0.9942551-2.0774727-1.8488808-3.2273331-2.5608292c1.1887207,1.8606033,1.8084946,4.1510124,1.8084946,6.736969
C60.9466667,61.6773338,51.587677,70.4490662,40.0840912,70.4490662z"/>`;
const baseReRoll = `<g transform="translate(15,15) scale(.75)">
<path d="M40.639,73.679c-6.373-6.379-9.324-14.869-8.893-23.215h15.467L23.606,26.857L0,50.464h14.714
c-0.04,9.1,3.371,18.217,10.313,25.162C35.904,86.506,52.097,88.77,65.234,82.5C56.451,83.343,47.368,80.406,40.639,73.679z"/>
<path d="M85.286,50.486c0.04-9.1-3.371-18.217-10.313-25.162c-10.877-10.88-27.075-13.144-40.207-6.871
c8.783-0.845,17.866,2.091,24.59,8.818c6.379,6.379,9.33,14.869,8.898,23.215H52.781l23.606,23.609L100,50.486H85.286z"/>
</g>`;
const QUID_BASE = `
<defs>
    <mask id="neg{0}">
        <rect width="100%" height="100%" fill="white"/>
        <text x="35" y="55" fill="black">{0}</text>
    </mask>
    </defs>
<path mask="url(#neg{0})"
  transform="translate(10,10)"
  d="M 38.28125 3.644531
  C 38.28125 3.644531 57.382812 36.878906 60.207031 49.476562
  C 63.148438 62.59375 50.390625 73.960938 38.28125 73.960938
  C 26.171875 73.960938 13.414062 62.59375 16.355469 49.476562
  C 19.179688 36.878906 38.28125 3.644531 38.28125 3.644531
  Z M 38.28125 3.644531 " stroke="none" fill-rule="nonzero" fill-opacity="1"/>`;
const ICON_SVG = new Map<Icon, string>(
  [
    [Icon.Quiddity1, QUID_BASE.replace(/\{0\}/g, '1')],
    [Icon.Quiddity2, QUID_BASE.replace(/\{0\}/g, '2')],
    [Icon.Draw1, `${baseDraw}<text x="46" y="55">1</text>`],
    [Icon.Draw2, `${baseDraw}<text x="46" y="55">2</text>`],
    [Icon.ReRoll, baseReRoll],
  ]
);
@Component({
  selector: 'app-die-side',
  templateUrl: './die-side.component.html',
  styleUrls: ['./die-side.component.scss']
})
export class DieSideComponent implements OnInit {
  @Input() public side: DieSide;
  @Input() public size: number;
constructor(private sanitizer: DomSanitizer, private renderer: Renderer2, private el: ElementRef) {}
  get background() {
    let svg: string;
    if (this.side.icon === Icon.Ready) {
      svg = this.side.die.readyIcon;
    } else {
      svg = ICON_SVG.get(this.side.icon);
    }
    return this.sanitizer.bypassSecurityTrustHtml(`<svg style="fill: currentColor;" viewBox="0 0 100 100">${svg}</svg>`);
  }
  get bursts() {
    return Array(this.side.burst + 1).join('*');
  }
  ngOnInit() {
    this.renderer.setAttribute(this.el.nativeElement, 'style', `--die-size:${this.size}px;`);
  }
}
